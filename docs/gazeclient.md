# GazeClient

GazeClient is the frontend library for [Gaze](gaze.md) that allows the browser to connect to the [GazeHub](gazehub.md) using [Server-Sent Events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events).

## Installation

GazeClient can be installed using [npm](https://www.npmjs.com/) with the following command:

```bash
npm install --save @isaac.frontend/gaze-client
```

## Usage

For GazeClient to be able to communicate with [GazeHub](gazehub.md), it needs the have a [JWT](https://jwt.io/). This JWT needs to be generated by the PHP application using the [GazePublisher](gazepublisher.md) library. To see what data this JWT contains see [GazePublisher](gazepublisher.md).

```javascript
const tokenResponse = await fetch('/token');
const tokenData = await tokenResponse.json();
const token = tokenData.token;
```

### Connecting

After the token is available, a connection to [GazeHub](gazehub.md) can be established. The example below is `https://hub.myapplication.com` the hub URL.

```javascript
const gaze = new GazeClient('https://hub.myapplication.com', token);
await gaze.connect();
```

### Subscriptions

Gaze makes use of subscriptions to subscribe to topics. Each subscription is associated with its callback function. Subscription can be made in three different ways, below are all three listed with examples.

```javascript
// Subscribe to a single topic
gaze.on('topic1', payload => {});

// Subscribe to multiple topics
gaze.on(['topic1', 'topic2'], payload => {});

// Subscribe dynamically to topics (the topic callback)
function getTopics() {
	const rows = [...document.querySelectorAll('.row')]
	return rows.map(r => 'topic' + r.getAttribute('data-id')); // ['topic1', 'topic2', 'topic3']
}

const subscription = await gaze.on(getTopics, payload => {});

// To update the subscription, call .update()
// This will call the given topic callback and 
// automatically subscribe and unsubscribe to the right topics.
// Can be used when, for example, navigating to another page on a SPA.
subscription.update();
```

## Development

GazeClient is written in [TypeScript](https://www.typescriptlang.org/) and uses [Webpack](https://webpack.js.org/) to transpile to JavaScript. You can use to following commands:

| Command | Description |
| ------- | ----------- |
| `npm install` | Installs all the dependencies. |
| `npm run build` | Builds GazeClient for production. Output is stored in `./dist`. |
| `npm run dev` | Builds GazeClient for development, without minification. Output is stored in `./dist`. |
| `npm run lint` | Run [ESLint](https://eslint.org/) to validate coding guidelines. |
| `npm run test` | Run [Jest](https://jestjs.io/) unit-tests to validate the working of GazeClient. |
