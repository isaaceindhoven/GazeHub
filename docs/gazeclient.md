# GazeClient

[GazeClient](https://github.com/isaaceindhoven/GazeClient) is the frontend library for [Gaze](gaze.md) that allows the browser to connect to the [GazeHub](gazehub.md). <br/>See the Complete install page for a detailed guide of how to install Gaze.

### Connecting as guest

Below you see an example of creating a connection with the hub using GazeClient.

```javascript
const gaze = new GazeClient('https://hub.myapplication.com');
await gaze.connect();
```

### Connecting with roles

It may occur that you only want specific events to be received by a certain role.
For this you can use the `setToken` method. <br/>
The expected token is a [JSON Web Token](https://jwt.io/). The JWT needs to be generated by the PHP application using the [GazePublisher](gazepublisher.md) library.

```javascript
const tokenRequest = await fetch('/token');
const tokenRequestJson = await tokenRequest.json();

const gaze = new GazeClient('https://hub.myapplication.com');
await gaze.connect();
await gaze.setToken(tokenRequestJson.token);
```

### Subscriptions

Gaze makes use of subscriptions to subscribe to topics. Each subscription is associated with its callback function. <br/>
Subscription can be made in three different ways:

<!-- tabs:start -->

#### **Single**

```javascript
// Subscribe to a single topic
const subscription = gaze.on('topic1', payload => {});
```

#### **Multiple**

```javascript
// Subscribe to multiple topics
const subscription = gaze.on(['topic1', 'topic2'], payload => {});
```

#### **Dynamic**

```javascript
// Subscribe dynamically to topics (the topic callback)
function getTopics() {
	const rows = [...document.querySelectorAll('.row')]
	return rows.map(r => 'topic' + r.getAttribute('data-id')); // ['topic1', 'topic2', 'topic3']
}
const subscription = await gaze.on(getTopics, payload => {});

// To update the subscription, call .update()
// This will call the given topic callback and 
// automatically subscribe and unsubscribe to the right topics.
// Can be used when, for example, navigating to another page on a SPA.
subscription.update();
```

<!-- tabs:end -->


#### Preventing memory leaks

You can use the `destroy` method on a subscription to unsubscribe from all topics. <br/>
This is useful in a Single Page Application when you unmount a component or page.

<!-- tabs:start -->

#### **Vue 3**

```javascript
onUnmounted(() => {
	subscription.destroy();
});
```

#### **React**

```javascript
componentWillUnmount() {
	subscription.destroy();
}
```

<!-- tabs:end -->

### Development

GazeClient is written in [TypeScript](https://www.typescriptlang.org/) and uses [Webpack](https://webpack.js.org/) to transpile to JavaScript. You can use to following commands:

| Command | Description |
| ------- | ----------- |
| `npm install` | Installs all the dependencies. |
| `npm run build` | Builds GazeClient for production. Output is stored in `./dist`. |
| `npm run dev` | Builds GazeClient for development, without minification. Output is stored in `./dist`. |
| `npm run lint` | Run [ESLint](https://eslint.org/) to validate coding guidelines. |
| `npm run test` | Run [Jest](https://jestjs.io/) unit-tests to validate the working of GazeClient. |
