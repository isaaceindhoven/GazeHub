# Authentication

### Key generation
Gaze uses [JSON Web Tokens (JWT)](https://jwt.io/) with the RS256-algorithm, this means that it needs a RSA-keypair. Use the following commands:

```bash
# Generate private key
openssl genrsa -out private.key 4096

# Extract public key from private key
openssl rsa -in private.key -outform PEM -pubout -out public.key
```

!> Make sure the **private key** never leaves the machine it will be used on.


| Key | Used By |
| --- | --- |
| Private | [GazePublisher](gazepublisher.md) to generate the client and server JWTs. |
| Public | [GazeHub](gazehub.md) to verify the JWT. |

### Client-to-server authentication
For [GazeClient](gazeclient.md) to authenticate itself to [GazeHub](gazehub.md) it needs a JWT with the roles the user has in the application. Because GazeClient and GazeHub both know nothing about users and their roles the tokens need to be generated by the application using GazePublisher.

The JWT for client-to-server authentication contains the following payload:

| Name | Description |
| --- | --- |
| roles | Array with all the roles the specific use has. |
| jti | JWT ID, the unique ID for the token. GazeHub uses the JTI to keep track of the different users. |

GazePublisher contains a method to generate this token for you:

```php
$userRoles = ['admin', 'sales'];
$minutesValid = 60;
$token = $gaze->generateClientToken($userRoles, $minutesValid);
```

Read the [example](example) page for a more detailed explanation of where to use this code.

### Server-to-server authentication
For [GazePublisher](gazepublisher.md) to be able to send events to GazeHub it needs a JWT specific for server actions. The server JWT is special because it contains `role = 'server'` in the payload. Without that role, it is not possible to post an event.

