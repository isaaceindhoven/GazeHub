# Authentication

For authentication, [Gaze](gaze.md) uses [JSON Web Tokens](https://jwt.io/) (JWT).

## Key generation
Gaze uses JWTs with the RS256-algorithm, this means that it needs an RSA-keypair. To generate a keypair run the following commands (run these commands on the application server and move the **public** key later to GazeHub):

!> Make sure the **private key** never leaves the machine it will be used on.

```bash
# Generate private key
openssl genrsa -out private.key 4096

# Extract public key from private key
openssl rsa -in private.key -outform PEM -pubout -out public.key
```

| Key Type | Used By |
| --- | --- |
| Private | [GazePublisher](gazepublisher.md) to generate the client and server JWTs. |
| Public | [GazeHub](gazehub.md) to verify the JWT. |

## Client-to-server authentication
For [GazeClient](gazeclient.md) to be able to authenticate the user on the [GazeHub](gazehub.md) it needs a JWT with the roles the user has in the application. Because GazeClient and GazeHub both know nothing about users and their roles the tokens need to be generated by the application using GazePublisher.

The JWT for client-to-server authentication contains the following payload:

| Name | Description |
| --- | --- |
| roles | Array with all the roles the specific use has. |
| jti | JWT ID, the unique ID for the token. GazeHub uses the JTI to keep track of the different users. |

GazePublisher contains a method to generate this token for you:

```php
$userRoles = ['admin', 'sales'];
$minutesValid = 60;
$token = $gaze->generateClientToken($userRoles, $minutesValid);
```

Read the [example](example) page for a more detailed explanation of where to use this code.

## Server-to-server authentication
For [GazePublisher](gazepublisher.md) to be able to send events to GazeHub it needs a JWT specific for server actions. The server JWT is special because it contains `role = 'server'` in the payload. Without that role, it is not possible to post an event.

## GazeHub authentication

GazeHub accepts the JWT differently on different routes:

| Route | HTTP method | Authentication method | JWT type |
|---|---|---|---|
| /event | POST | Authentication header | Server JWT with `role='server'` |
| /subscription | POST | Authentication header | Client JWT with `roles=['..']` |
| /subscription | DELETE | Authentication header | Client JWT with `roles=['..']` |
| /sse | GET | Query /sse?token=... | Client JWT with `roles=['..']` |

