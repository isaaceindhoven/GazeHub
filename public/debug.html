<!DOCTYPE html>
<html lang="en" class="w-full h-full">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emitter</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="w-full h-full bg-gray-50 flex items-center justify-center">
    <div class="flex flex-col bg-white rounded-xl shadow p-8">
        <div class="flex flex-col mb-6">
            <label class="mb-1 uppercase tracking-wide text-gray-500 text-xs">Topic:</label>
            <input id="topic" class="w-64 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded" type="text">
        </div>
        <div class="flex flex-col mb-6">
            <label class="mb-1 uppercase tracking-wide text-gray-500 text-xs">Role:</label>
            <input id="role" class="w-64 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded" type="text">
        </div>
        <div class="flex flex-col mb-4">
            <label class="mb-1 uppercase tracking-wide text-gray-500 text-xs">Payload:</label>
            <pre 
                contenteditable="true" 
                id="payload"
                class="w-64 h-32 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded"/></pre>
        </div>
        <div id="send" class="bg-yellow-400 hover:bg-yellow-500 cursor-pointer text-white py-4 rounded text-center">
            Send
        </div>
    </div>

    <script>

        let $sendBtn = document.querySelector("#send");

        document.querySelector("#topic").value = "ProductUpdated/1";
        document.querySelector("#payload").textContent = JSON.stringify({
            "id" : 1,
            "name" : "Shirt XL",
            "price" : 10.35
        }, null, 2);

        $sendBtn.addEventListener("click", async () => {

            let topic = document.querySelector("#topic").value;
            let role = document.querySelector("#role").value;
            let payload = JSON.parse(document.querySelector("#payload").textContent);

            console.log({topic, role, payload});

            await fetch("/event", {
                method: "POST",
                body : JSON.stringify({
                    "topic" : topic,
                    "payload" : payload,
                    "role" : role
                }),
                headers: {
                    "Content-Type" : "application/json",
                    "Authorization" : "X.eyJyb2xlIjoic2VydmVyIn0=.X"
                }
            })

        });

    </script>
</body>
</html>